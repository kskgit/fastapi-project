# E2E ãƒ†ã‚¹ãƒˆ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

## åŸºæœ¬æ–¹é‡

### ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®åŸå‰‡
E2Eãƒ†ã‚¹ãƒˆã¯**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰å˜ä½**ã§å®Ÿè£…ã—ã€å„HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä»£è¡¨çš„ãªã‚±ãƒ¼ã‚¹ã‚’ç¶²ç¾…ã™ã‚‹ã€‚
è©³ç´°ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¯å˜ä½“ãƒ†ã‚¹ãƒˆã§ã‚«ãƒãƒ¼ã™ã‚‹ã€‚

### è²¬å‹™åˆ†é›¢
- **E2Eãƒ†ã‚¹ãƒˆ**: HTTPã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¥‘ç´„ã®æ¤œè¨¼
- **å˜ä½“ãƒ†ã‚¹ãƒˆ**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è©³ç´°æ¤œè¨¼

## ãƒ†ã‚¹ãƒˆå®Ÿè£…è¦ç´„

### 1. ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹å‘½åè¦å‰‡

```python
class Test{Entity}{Action}E2E:
    """E2E tests for {entity} {action} via HTTP API."""
    
# ä¾‹
class TestCreateTodoE2E:
    """E2E tests for todo creation via HTTP API."""
```

### 2. ãƒ†ã‚¹ãƒˆãƒ¡ã‚½ãƒƒãƒ‰å‘½åè¦å‰‡

```python
async def test_{action}_{entity}_{scenario}_{status_code}(self):
    """Test {action} {entity} {scenario description} â†’ {status_code}"""

# ä¾‹
async def test_create_todo_success_201(self):
    """Test successful todo creation â†’ 201"""
    
async def test_create_todo_validation_error_400(self):
    """Test todo creation with invalid data â†’ 400"""
    
async def test_create_todo_user_not_found_404(self):
    """Test todo creation with non-existent user â†’ 404"""
```

### 3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰åˆ¥å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 2xx Success
```python
async def test_create_todo_success_201(self):
    """æ­£å¸¸ç³»ã®ä»£è¡¨ä¾‹ï¼ˆæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªã‚±ãƒ¼ã‚¹ï¼‰"""
    # åŸºæœ¬çš„ãªå…¥åŠ›å€¤ã§æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œè¨¼
    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
    # DBæ°¸ç¶šåŒ–ã‚’ GET ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§æ¤œè¨¼
```

#### 4xx Client Error
```python
async def test_create_todo_validation_error_400(self):
    """ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®ä»£è¡¨ä¾‹"""
    # æ˜ã‚‰ã‹ã«ä¸æ­£ãªå…¥åŠ›å€¤
    # ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã®ç¢ºèª
    # DBå¤‰æ›´ãŒãªã„ã“ã¨ã‚’ç¢ºèª
    
async def test_create_todo_user_not_found_404(self):
    """ãƒªã‚½ãƒ¼ã‚¹æœªç™ºè¦‹ã‚¨ãƒ©ãƒ¼"""
    # å­˜åœ¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
    # é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª
```

#### 5xx Server Error
```python
async def test_create_todo_server_error_500(self):
    """ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ã®ä»£è¡¨ä¾‹"""
    # DBæ¥ç¶šã‚¨ãƒ©ãƒ¼ãªã©ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    # é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¢ºèª
```

### 4. ãƒ†ã‚¹ãƒˆæ§‹é€ è¦ç´„

```python
async def test_method_name(self):
    """Test description."""
    # Arrange - ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
    request_data = {
        "field": "value"
    }
    
    # Act - HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Ÿè¡Œ
    response = await test_client.post("/endpoint", json=request_data)
    
    # Assert - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
    assert response.status_code == expected_status
    response_data = response.json()
    
    # Assert - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ æ¤œè¨¼
    assert "required_field" in response_data
    
    # Assert - DBçŠ¶æ…‹ç¢ºèªï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
    verification_response = await test_client.get(f"/endpoint/{id}")
    assert verification_response.status_code == 200
```

### 5. æ¤œè¨¼é …ç›®

#### å¿…é ˆæ¤œè¨¼é …ç›®
- **HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰**: æœŸå¾…å€¤ã¨ã®ä¸€è‡´
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ **: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨
- **ãƒ‡ãƒ¼ã‚¿å‹**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹ç¢ºèª

#### æ¨å¥¨æ¤œè¨¼é …ç›®
- **DBæ°¸ç¶šåŒ–**: GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®ç¢ºèª
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼æƒ…å ±
- **å‰¯ä½œç”¨**: ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã¸ã®å½±éŸ¿ç¢ºèª

### 6. ãƒ‡ãƒ¼ã‚¿æº–å‚™è¦ç´„

#### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿åŸå‰‡
```python
# âœ… Good: ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„
todo_data = {
    "title": "Complete project documentation"
}

# âŒ Bad: è¤‡é›‘ã™ãã‚‹
todo_data = {
    "title": "Complex title with unicode ğŸš€ and special chars",
    "description": "Very long description..." * 100,
    "due_date": datetime.now() + timedelta(days=random.randint(1, 365))
}
```

#### ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£æ´»ç”¨
```python
# conftest.py ã§å…±é€šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å®šç¾©
@pytest.fixture
async def test_user(test_db_session):
    """Standard test user for E2E tests."""
    # æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
```

## å¯¾è±¡å¤–äº‹é …

### E2Eãƒ†ã‚¹ãƒˆã§å®Ÿè£…ã—ãªã„é …ç›®
- **è©³ç´°ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³**: å˜ä½“ãƒ†ã‚¹ãƒˆã§å®Ÿè£…
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†å²**: å˜ä½“ãƒ†ã‚¹ãƒˆã§å®Ÿè£…
- **å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ**: å˜ä½“ãƒ†ã‚¹ãƒˆã§å®Ÿè£…
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ**: å°‚ç”¨ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã§å®Ÿè£…

### å˜ä½“ãƒ†ã‚¹ãƒˆã§å®Ÿè£…ã™ã‚‹é …ç›®
```python
# Unit Test Examples
class TestCreateTodoUseCase:
    def test_create_todo_with_all_fields(self):
        """å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æŒ‡å®šãƒ‘ã‚¿ãƒ¼ãƒ³"""
        
    def test_create_todo_with_minimal_fields(self):
        """æœ€å°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³"""
        
    def test_create_todo_with_past_due_date(self):
        """éå»æ—¥ä»˜ãƒ‘ã‚¿ãƒ¼ãƒ³"""
        
    def test_create_todo_title_boundary_values(self):
        """ã‚¿ã‚¤ãƒˆãƒ«é•·ã®å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆ"""
```

## å®Ÿè¡Œãƒ»ä¿å®ˆè¦ç´„

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# E2Eãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
task test-e2e

# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
task test-all
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®
- **é«˜é€Ÿå®Ÿè¡Œ**: ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªSQLiteä½¿ç”¨
- **ä¸¦åˆ—å®Ÿè¡Œ**: å¯èƒ½ãªé™ã‚Šç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹
- **æœ€å°ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: å¿…è¦æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿æº–å‚™

### ä¿å®ˆæ€§ç¢ºä¿
- **æ˜ç¢ºãªå‘½å**: ãƒ†ã‚¹ãƒˆæ„å›³ãŒä¼ã‚ã‚‹åå‰
- **é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆ**: è¤‡é›‘ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã®èª¬æ˜
- **DRYåŸå‰‡**: å…±é€šå‡¦ç†ã®ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£åŒ–

## å“è³ªåŸºæº–

### å¿…é ˆè¦ä»¶
- ã™ã¹ã¦ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ä¸»è¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚«ãƒãƒ¼
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ä¸€è²«æ€§æ¤œè¨¼
- HTTPã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¥‘ç´„ã®æº–æ‹ 

### æ¨å¥¨è¦ä»¶
- OpenAPIä»•æ§˜ã¨ã®æ•´åˆæ€§ç¢ºèª
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆï¼ˆèªè¨¼ãƒ»èªå¯ï¼‰
- CORSã€Content-Typeç­‰ã®HTTPãƒ˜ãƒƒãƒ€æ¤œè¨¼

## ä¾‹å¤–äº‹é …

### è¤‡é›‘ãªE2Eãƒ†ã‚¹ãƒˆãŒå¿…è¦ãªå ´åˆ
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼**: è¤‡æ•°APIã®é€£æºãŒå¿…è¦
- **å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº**: å®Ÿéš›ã®çµ±åˆå‹•ä½œç¢ºèª
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ**: è¤‡æ•°å‡¦ç†ã®æ•´åˆæ€§ç¢ºèª

ã“ã®å ´åˆã¯ã€åˆ¥é€” `integration` ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè£…ã™ã‚‹ã€‚

---

ã“ã®è¦ç´„ã«ã‚ˆã‚Šã€åŠ¹ç‡çš„ã§ä¿å®ˆæ€§ã®é«˜ã„E2Eãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚’å®Ÿç¾ã™ã‚‹ã€‚