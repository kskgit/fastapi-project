# このドキュメントについて
新規機能追加及び、機能改修を行う際の効率的な開発ステップ及び開発手法を示すもの

# 開発ステップ
1. **E2E テストを先に書く**  
   まずは `docs/test/e2e.md` のガイドに沿って E2E テストで期待する振る舞いを固定する。成功・4xx・500 系レスポンスをそれぞれ 1 ケースずつ書き、必要な振る舞いを先に定義する。
1. **Controller を最小限で実装する**  
   先に作った E2E を通すための最小限のController を用意する。ここではリクエスト/レスポンスのスキーマ定義とルーティング、バリデーションの骨格に集中し、ビジネスロジックは Usecase へ委譲するスタブを置く程度に留める。
1. **Usecase を組み立てる**  
   Controller から呼び出されるユースケース層に処理の流れを集約し、単一責務でサブタスク作成・更新・削除などの手続きを実装する。必要な Repository インターフェースに依存する形で設計し、まだ永続化レイヤを実装していなくてもテストが進められる状態にする。
1. **Repository / DB（SQLModel）を実装する**  
   Usecase が期待するインターフェースに従って SQLModel ベースの Repository を実装し、DI 設定に登録する。スキーマやマイグレーション、トランザクション管理はこの段階で整備し、E2E が実際の DB を通過することを確認する。

# 開発手法
各ステップ毎にこの開発手法で実装する。
**t_wada の TDD（テスト駆動開発）を実践**。
ユーザからの指示がある場合を除き、以下のルールを **必ず守って** 開発してください。

## 新規機能/改修の依頼を受けたとき
- 依頼内容が曖昧または複数機能を含んでいる場合は、そのまま着手せずに前提・期待結果・API などを質問して明確化する。
- 依頼に複数操作や異なるユースケースが含まれる場合は、メインのユースケース単位（例: サブタスク作成、サブタスク完了）で TODO を分割できる構成案を提示し、ユーザの合意を得る。
- TODO を分割した後も、各 TODO を完了するごとにユーザの承認を得て次へ進む。

## 開発プロセスのルール
開発プロセス毎に必ずユーザに受け入れを求める。承認を得るまでは次のフェーズに進まないこと。
1. **TODOを作成する**
   - [開発ステップ](#開発ステップ)を参考に作成
   - TODOは「1機能=1TODO」を原則とし、メインとなるユースケース単位（例: サブタスク作成、サブタスク完了）で分割する。複数操作をまとめた大きなTODOは、着手前に粒度を見直し小さく分割してから進める。
      ```md
      <!-- 作成すえる TODOのイメージ-->
      1. サブタスク作成 API の期待振る舞い（成功ケース・代表的な 4xx・500 系）を e2e テストで固定する。
      2. テストを通すための最小限のサブタスク作成用 Controller／DTO 骨格を追加する（ユースケースはスタブで OK）。
      3. サブタスク作成ユースケースを実装し、DI 設定に組み込む。
      4. サブタスクのドメイン／DB モデル・リポジトリ実装を追加し、サブタスク作成が永続化されるようにする。
      ```
   - これから先はTODOを一つづつ解消していくこと
1. **最初に失敗するテストを書く（Red）**
   - 実装は一切書かず、テストコードのみを書くこと
   - テストは「振る舞い」を表現し、内部実装に依存しないこと
   - テスト名は日本語 or 英語で意図が明確に分かるものにする
1. **テストを通すための最小限の実装を書く（Green）**
   - テストを通すためだけの、最小限・ベタ書きの実装でよい
   - 先読み設計・汎用化・リファクタリングはこの段階では行わない
1. **必要になったタイミングでのみリファクタリングを行う（Refactor）**
   - 重複の除去、命名改善、責務分離などを行う
   - テストの意味がより明確になる方向でリファクタリングする
